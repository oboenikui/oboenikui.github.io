<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>tweet intent</title>
    <script>
        var suggest = function(){
            if(document.location.search.length){
                var params = document.location.search.substring(1).split("&");
                console.log(params);
                for (var i = 0; i < params.length; i++) {
                    var pair = params[i].split("=");
                    if (pair[0] == "encoded_url") {
                        open(pair[1]);
                        return;
                    }
                }
            }
        }
        var open = function (str) {
            var url = window.atob(str);
            if (url.indexOf("http://") == 0 || url.indexOf("https://") == 0) {
                window.location.href = url;
            }
        }
        suggest();
        
        var encode = function () {
            var url = document.getElementById("url").value;
            var resultElement = document.getElementById("encoded_url");
            if (url && (url.indexOf("http://") == 0 || url.indexOf("https://") == 0)) {
                resultElement.value = "http://oboenikui.com/intent?encoded_url=" + window.btoa(url);
            } else if(url) {
                resultElement.value = "http://oboenikui.com/intent?encoded_url=" + window.btoa("http://"+url);
            }
            resultElement.focus();
            resultElement.select();
        }
    </script>
</head>
<body>
    <form name="encode_form" action="/intent" method="GET" onsubmit="encode(); return false;">
        <input id="url" type="text" />
        <input type="submit" /><br />
        <input id="encoded_url" type="text" readonly="readonly" value="Result URL" />
    </form>
</body>
</html>
